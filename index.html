<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ICPC Problem Archive - Preserving 50 Years of Programming Contest History">
    <meta name="keywords" content="ICPC, programming contests, competitive programming, archive">
    <title>ICPC Problem Archive</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Menlo:wght@700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <header class="header" role="banner">
            <div class="header-content">
                <img class="logo" src="https://avatars.githubusercontent.com/u/5224374?s=280&v=4" alt="ICPC Archive Logo">
                <div class="header-text">
                    <h1 class="main-title">ICPC Problem Archive</h1>
                    <p class="subtitle">Preserving 50 Years of Programming Contest History</p>
                </div>
                <div class="header-info">
                    <div class="info-item">
                        <svg class="info-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
                            <path d="M8.00004 14.6667C11.6819 14.6667 14.6667 11.6819 14.6667 8.00001C14.6667 4.31811 11.6819 1.33334 8.00004 1.33334C4.31814 1.33334 1.33337 4.31811 1.33337 8.00001C1.33337 11.6819 4.31814 14.6667 8.00004 14.6667Z" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M8 12C10.2091 12 12 10.2091 12 8C12 5.79086 10.2091 4 8 4C5.79086 4 4 5.79086 4 8C4 10.2091 5.79086 12 8 12Z" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M7.99996 9.33332C8.73634 9.33332 9.33329 8.73637 9.33329 7.99999C9.33329 7.26361 8.73634 6.66666 7.99996 6.66666C7.26358 6.66666 6.66663 7.26361 6.66663 7.99999C6.66663 8.73637 7.26358 9.33332 7.99996 9.33332Z" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span>Collecting problems from all ICPC contests</span>
                    </div>
                    <div class="info-item">
                        <svg class="info-icon" width="17" height="16" viewBox="0 0 17 16" fill="none" aria-hidden="true">
                            <path d="M10.47 2H14.47V6" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M7.1366 9.33333L14.4699 2" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12.47 8.66667V12.6667C12.47 13.0203 12.3295 13.3594 12.0794 13.6095C11.8294 13.8595 11.4903 14 11.1366 14H3.8033C3.44968 14 3.11054 13.8595 2.86049 13.6095C2.61045 13.3594 2.46997 13.0203 2.46997 12.6667V5.33333C2.46997 4.97971 2.61045 4.64057 2.86049 4.39052C3.11054 4.14048 3.44968 4 3.8033 4H7.8033" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <a href="https://icpc.global" target="_blank" rel="noopener noreferrer">icpc.global</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="navigation" role="navigation" aria-label="Main Navigation">
            <ul class="nav-content">
                <li><a href="#progress" class="nav-item active">
                    <svg class="nav-icon" width="17" height="16" viewBox="0 0 17 16" fill="none" aria-hidden="true">
                        <path d="M2.70215 8H2.70882" stroke="#020817" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2.70215 12H2.70882" stroke="#020817" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2.70215 4H2.70882" stroke="#020817" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6.03552 8H14.7022" stroke="#020817" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6.03552 12H14.7022" stroke="#020817" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6.03552 4H14.7022" stroke="#020817" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Contest Progress
                </a></li>
                <li><a href="#contributors" class="nav-item">
                    <svg class="nav-icon" width="17" height="16" viewBox="0 0 17 16" fill="none" aria-hidden="true">
                        <path d="M11.3689 14V12.6667C11.3689 11.9594 11.0879 11.2811 10.5878 10.781C10.0877 10.281 9.40943 10 8.70219 10H4.70219C3.99495 10 3.31667 10.281 2.81657 10.781C2.31647 11.2811 2.03552 11.9594 2.03552 12.6667V14" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6.70219 7.33333C8.17495 7.33333 9.36886 6.13943 9.36886 4.66667C9.36886 3.19391 8.17495 2 6.70219 2C5.22943 2 4.03552 3.19391 4.03552 4.66667C4.03552 6.13943 5.22943 7.33333 6.70219 7.33333Z" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M15.3688 14V12.6667C15.3683 12.0758 15.1717 11.5019 14.8097 11.0349C14.4477 10.5679 13.9409 10.2344 13.3688 10.0867" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M11.3688 2.08667C11.9424 2.23354 12.4508 2.56714 12.8139 3.03488C13.1769 3.50262 13.374 4.07789 13.374 4.67C13.374 5.26212 13.1769 5.83739 12.8139 6.30513C12.4508 6.77287 11.9424 7.10647 11.3688 7.25334" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Contributors
                </a></li>
                <li><a href="#help" class="nav-item">
                    <svg class="nav-icon" width="17" height="16" viewBox="0 0 17 16" fill="none" aria-hidden="true">
                        <path d="M8.70219 14.6666C12.3841 14.6666 15.3689 11.6819 15.3689 7.99998C15.3689 4.31808 12.3841 1.33331 8.70219 1.33331C5.02029 1.33331 2.03552 4.31808 2.03552 7.99998C2.03552 11.6819 5.02029 14.6666 8.70219 14.6666Z" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6.76221 6.00001C6.91894 5.55446 7.22831 5.17875 7.63551 4.93944C8.04271 4.70012 8.52147 4.61264 8.98699 4.69249C9.45251 4.77234 9.87475 5.01436 10.1789 5.3757C10.4831 5.73703 10.6496 6.19436 10.6489 6.66668C10.6489 8.00001 8.64887 8.66668 8.64887 8.66668" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8.70215 11.3333H8.70882" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    How to Help
                </a></li>
                <li><a href="#contact" class="nav-item">
                    <svg class="nav-icon" width="17" height="16" viewBox="0 0 17 16" fill="none" aria-hidden="true">
                        <path d="M11.3688 1.33331V2.66665" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M5.36877 14.6667V13.3333C5.36877 12.9797 5.50925 12.6406 5.7593 12.3905C6.00935 12.1405 6.34849 12 6.70211 12H10.7021C11.0557 12 11.3949 12.1405 11.6449 12.3905C11.895 12.6406 12.0354 12.9797 12.0354 13.3333V14.6667" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6.03552 1.33331V2.66665" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M8.70215 9.33331C9.80672 9.33331 10.7021 8.43788 10.7021 7.33331C10.7021 6.22874 9.80672 5.33331 8.70215 5.33331C7.59758 5.33331 6.70215 6.22874 6.70215 7.33331C6.70215 8.43788 7.59758 9.33331 8.70215 9.33331Z" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M13.3688 2.66669H4.03548C3.2991 2.66669 2.70215 3.26364 2.70215 4.00002V13.3334C2.70215 14.0697 3.2991 14.6667 4.03548 14.6667H13.3688C14.1052 14.6667 14.7021 14.0697 14.7021 13.3334V4.00002C14.7021 3.26364 14.1052 2.66669 13.3688 2.66669Z" stroke="#64748B" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Contact
                </a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="main-content" tabindex="-1">
            <!-- About Section -->
            <section class="about-section">
                <div class="section-header">
                    <svg class="section-icon" width="25" height="25" viewBox="0 0 25 25" fill="none" aria-hidden="true">
                        <path d="M21.1792 3.41785H3.1792C2.62691 3.41785 2.1792 3.86556 2.1792 4.41785V7.41785C2.1792 7.97013 2.62691 8.41785 3.1792 8.41785H21.1792C21.7315 8.41785 22.1792 7.97013 22.1792 7.41785V4.41785C22.1792 3.86556 21.7315 3.41785 21.1792 3.41785Z" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M4.1792 8.41785V19.4178C4.1792 19.9483 4.38991 20.457 4.76499 20.8321C5.14006 21.2071 5.64877 21.4178 6.1792 21.4178H18.1792C18.7096 21.4178 19.2183 21.2071 19.5934 20.8321C19.9685 20.457 20.1792 19.9483 20.1792 19.4178V8.41785" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M10.1792 12.4178H14.1792" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <h2>About the Project</h2>
                </div>
                <p class="about-description">
                    The ICPC Problem Archive project aims to collect and preserve all problems from every ICPC contest throughout its nearly 50-year history. This comprehensive archive includes problem statements, test data, solutions, and complete problem packages from contests at all levels - from local contests to the World Finals.
                </p>
                <p class="about-mission">
                    Our mission is to create a complete historical record of competitive programming problems that have shaped the field, making them accessible for educational purposes, research, and historical preservation.
                </p>
            </section>

            <!-- Contest Progress Section -->
            <section id="progress" class="progress-section">
                <h2>Contest Archive Progress</h2>
                <p class="section-description">Track the collection status for all ICPC contests organized by region and year.</p>
                
                <div class="filters">
                    <div class="filter-group">
                        <label for="missing-filter">Filter by missing:</label>
                        <select id="missing-filter" class="filter-select">
                            <option value="all">Show all</option>
                            <option value="missing">Show any missing</option>
                            <option value="statements">Missing statements</option>
                            <option value="data">Missing test data</option>
                            <option value="solutions">Missing solutions</option>
                            <option value="packages">Missing packages</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="region-filter">Region:</label>
                        <select id="region-filter" class="filter-select">
                            <option value="all">All</option>
                            <option value="International">International</option>
                            <option value="North America">North America</option>
                            <option value="Europe">Europe</option>
                        </select>
                    </div>
                    <div class="filter-instruction">
                        <span class="instruction-text">*You may select an incomplete badge to submit data for the respective contest</span>
                    </div>
                </div>

                <div class="contest-hierarchy" role="tree" id="contest-hierarchy">
                    <!-- Dynamic content will be loaded here -->
                    <div class="loading-message">Loading contest data...</div>
                </div>
            </section>

            <!-- Contributors Section -->
            <section id="contributors" class="contributors-section">
                <div class="section-header">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="33" viewBox="0 0 32 33" fill="none">
                        <path d="M21.3334 28.5V25.8333C21.3334 24.4188 20.7715 23.0623 19.7713 22.0621C18.7711 21.0619 17.4145 20.5 16 20.5H8.00002C6.58553 20.5 5.22898 21.0619 4.22878 22.0621C3.22859 23.0623 2.66669 24.4188 2.66669 25.8333V28.5" stroke="#020817" stroke-width="2.66667" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 15.1667C14.9455 15.1667 17.3334 12.7789 17.3334 9.83333C17.3334 6.88781 14.9455 4.5 12 4.5C9.0545 4.5 6.66669 6.88781 6.66669 9.83333C6.66669 12.7789 9.0545 15.1667 12 15.1667Z" stroke="#020817" stroke-width="2.66667" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M29.3333 28.5V25.8333C29.3324 24.6516 28.9391 23.5037 28.2151 22.5698C27.4911 21.6358 26.4775 20.9688 25.3333 20.6733" stroke="#020817" stroke-width="2.66667" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M21.3333 4.67334C22.4805 4.96707 23.4974 5.63427 24.2235 6.56975C24.9496 7.50523 25.3438 8.65578 25.3438 9.84001C25.3438 11.0242 24.9496 12.1748 24.2235 13.1103C23.4974 14.0457 22.4805 14.7129 21.3333 15.0067" stroke="#020817" stroke-width="2.66667" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    <h2>Project Contributors</h2>
                </div>
                <p class="section-description">Meet the dedicated team working to preserve ICPC history.</p>
                
                <div class="contributors-grid">
                    <div class="contributor-card">
                        <div class="contributor-avatar">FN</div>
                        <div class="contributor-info">
                            <h3>Fredrik Niemelä</h3>
                            <span class="contributor-role">Project Lead</span>
                            <p class="contributor-affiliation">ICPC Role</p>
                            <p class="contributions-label">Contributions:</p>
                            <div class="contribution-tags">
                                <span class="tag">Project coordination</span>
                                <span class="tag">Historical research</span>
                                <span class="tag">Data validation</span>
                            </div>
                            <div class="social-links">
                                <a href="#" class="social-link">LinkedIn</a>
                                <a href="#" class="social-link">GitHub</a>
                                <a href="mailto:fredrik@niemela.se" class="social-link">Email</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="contributor-card">
                        <div class="contributor-avatar">MR</div>
                        <div class="contributor-info">
                            <h3>Miguel Revilla Rodríguez</h3>
                            <span class="contributor-role">Project Lead</span>
                            <p class="contributor-affiliation">ICPC Role</p>
                            <p class="contributions-label">Contributions:</p>
                            <div class="contribution-tags">
                                <span class="tag">Repository management</span>
                                <span class="tag">Data processing</span>
                                <span class="tag">Tool development</span>
                            </div>
                            <div class="social-links">
                                <a href="#" class="social-link">LinkedIn</a>
                                <a href="#" class="social-link">GitHub</a>
                                <a href="mailto:yo@miguelrevilla.com" class="social-link">Email</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="contributor-card">
                        <div class="contributor-avatar">CL</div>
                        <div class="contributor-info">
                            <h3>Christian Yongwhan Lim</h3>
                            <span class="contributor-role">Project Lead</span>
                            <p class="contributor-affiliation">ICPC Role</p>
                            <p class="contributions-label">Contributions:</p>
                            <div class="contribution-tags">
                                <span class="tag">European contests</span>
                                <span class="tag">Problem collection</span>
                                <span class="tag">Community outreach</span>
                            </div>
                            <div class="social-links">
                                <a href="#" class="social-link">LinkedIn</a>
                                <a href="#" class="social-link">GitHub</a>
                                <a href="mailto:christian.lim@icpc.global" class="social-link">Email</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="contributor-card">
                        <div class="contributor-avatar">AL</div>
                        <div class="contributor-info">
                            <h3>Ann Lee</h3>
                            <span class="contributor-role">Intern</span>
                            <p class="contributor-affiliation">Columbia University</p>
                            <p class="contributions-label">Contributions:</p>
                            <div class="contribution-tags">
                                <span class="tag">Asian contests</span>
                                <span class="tag">Data organization</span>
                                <span class="tag">Quality assurance</span>
                            </div>
                            <div class="social-links">
                                <a href="#" class="social-link">LinkedIn</a>
                                <a href="#" class="social-link">GitHub</a>
                                <a href="mailto:ann.lee@icpc.foundation" class="social-link">Email</a>
                            </div>
                        </div>
                    </div>
                    
                    <div class="contributor-card">
                        <div class="contributor-avatar">EL</div>
                        <div class="contributor-info">
                            <h3>Erica Lee</h3>
                            <span class="contributor-role">Intern</span>
                            <p class="contributor-affiliation">Princeton University</p>
                            <p class="contributions-label">Contributions:</p>
                            <div class="contribution-tags">
                                <span class="tag">contributor coordination</span>
                                <span class="tag">Documentation</span>
                                <span class="tag">External relations</span>
                            </div>
                            <div class="social-links">
                                <a href="#" class="social-link">LinkedIn</a>
                                <a href="#" class="social-link">GitHub</a>
                                <a href="mailto:erica.lee@icpc.foundation" class="social-link">Email</a>
                            </div>
                        </div>
                    </div>

                    <div class="contributor-card">
                        <div class="contributor-avatar">NV</div>
                        <div class="contributor-info">
                            <h3>Nicholas Vickery</h3>
                            <span class="contributor-role">Intern</span>
                            <p class="contributor-affiliation">Princeton University</p>
                            <p class="contributions-label">Contributions:</p>
                            <div class="contribution-tags">
                                <span class="tag">contributor coordination</span>
                                <span class="tag">Documentation</span>
                                <span class="tag">External relations</span>
                            </div>
                            <div class="social-links">
                                <a href="#" class="social-link">LinkedIn</a>
                                <a href="#" class="social-link">GitHub</a>
                                <a href="mailto:nicholas.vickery@icpc.foundation" class="social-link">Email</a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- How to Help Section -->
            <section id="help" class="help-section">
                <h2>How You Can Help</h2>                
                <div class="help-cards">
                    <div class="help-card">
                        <div class="help-card-header">
                            <h3>Problem Statements</h3>
                        </div>
                        <p>Help us collect missing problem statements from ICPC contests</p>
                        <div class="help-requirements">
                            <h4>What we need:</h4>
                            <ul>
                                <li>PDF files of official problem statements</li>
                                <li>Scanned copies of historical problems</li>
                            </ul>
                        </div>
                        <button class="help-button">Submit Problem Statements</button>
                    </div>
                    
                    <div class="help-card">
                        <div class="help-card-header">
                            <h3>Test Data</h3>
                        </div>
                        <p>Provide test cases and input/output data for problems</p>
                        <div class="help-requirements">
                            <h4>What we need:</h4>
                            <ul>
                                <li>Official test data files (input/output)</li>
                                <li>Additional test cases you've created</li>
                                <li>Test data validators</li>
                            </ul>
                        </div>
                        <button class="help-button">Submit Test Data</button>
                    </div>
                    
                    <div class="help-card">
                        <div class="help-card-header">
                            <h3>Solutions</h3>
                        </div>
                        <p>Share solution code and editorial explanations</p>
                        <div class="help-requirements">
                            <h4>What we need:</h4>
                            <ul>
                                <li>Official solutions from the contest judges</li>
                                <li>Editorial explanations and approaches</li>
                                <li>Alternative solution implementations</li>
                                <li>Solution analysis and complexity discussions</li>
                            </ul>
                        </div>
                        <button class="help-button">Submit Solutions</button>
                    </div>
                    
                    <div class="help-card">
                        <div class="help-card-header">
                            <h3>Problem Packages</h3>
                        </div>
                        <p>Complete problem packages in standard formats</p>
                        <div class="help-requirements">
                            <h4>What we need:</h4>
                            <ul>
                                <li>Kattis problem packages (.kpp format)</li>
                                <li>Complete packages with all components</li>
                                <li>Validated and tested problem sets</li>
                            </ul>
                        </div>
                        <button class="help-button">Submit Packages</button>
                    </div>
                    
                    <div class="help-card">
                        <div class="help-card-header">
                            <h3>Create Packages</h3>
                        </div>
                        <p>Help create problem packages when we have statements, data, and solutions</p>
                        <div class="help-requirements">
                            <h4>What we need:</h4>
                            <ul>
                                <li>Package creation skills using .kpp format</li>
                                <li>Ability to combine statements, test data, and solutions</li>
                                <li>Knowledge of problem package validation</li>
                                <li>Experience with contest management systems</li>
                            </ul>
                        </div>
                        <button class="help-button">Contribute to Create Packages</button>
                    </div>
                </div>
                
                <!-- Submission Guidelines -->
                <div class="submission-guidelines">
                    <h3>Submission Guidelines</h3>
                    <div class="guidelines-content">
                        <div class="guidelines-section">
                            <h4>Before submitting:</h4>
                            <ul>
                                <li>Ensure you have permission to share the materials</li>
                                <li>Include contest name, year, and region information</li>
                                <li>Provide any additional context about the source</li>
                                <li>Check if we already have the materials in our database</li>
                            </ul>
                        </div>
                        <div class="guidelines-section">
                            <h4>Preferred formats:</h4>
                            <ul>
                                <li>Problem statements: PDF or LaTeX source</li>
                                <li>Test data: ZIP archives with clear file naming</li>
                                <li>Solutions: Source code with comments</li>
                                <li>Packages: Standard contest management system formats</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Contact Section -->
            <section id="contact" class="contact-section">
                <h2>General Questions & Contact</h2>
                <p class="contact-description">Not sure how to help or have questions about the project?</p>
                <p class="contact-message">We welcome any contributions, no matter how small! Whether you have materials from a single contest or want to help with data organization, your contribution is valuable to preserving ICPC history.</p>
                <a href="mailto:fredrik@icpc.global" class="contact-button">Contact Us</a>
            </section>
        </main>
    </div>

    <!-- Modal Overlay -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title">
                    <svg class="modal-icon" id="modal-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <!-- Default document icon -->
                        <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M14 2V8H20" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16 13H8" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M16 17H8" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M10 9H9H8" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <h2 id="modal-title">Help with Problem Statements</h2>
                </div>
                <button class="modal-close" id="modal-close" aria-label="Close modal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                        <path d="M18 6L6 18" stroke="#64748B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M6 6L18 18" stroke="#64748B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
            <div class="modal-content">
                <p id="modal-description">Help us by providing the official problem statement PDF</p>
                
                <div class="modal-form">
                    <div class="form-label-container" id="form-label-container" style="display: none;">
                        <span class="form-label-tag" id="modal-label-tag">Problem Statements</span>
                    </div>
                    <select id="contest-select" class="form-select">
                        <option value="">Choose a contest...</option>
                    </select>
                    
                    <div class="github-username-field" id="github-username-field" style="display: none;">
                        <label for="github-username">GitHub Username:</label>
                        <input type="text" id="github-username" class="form-input" placeholder="Enter your GitHub username" />
                        <div class="validation-message" id="github-validation-message"></div>
                    </div>
                         
                    <div class="modal-next-steps">
                        <h4>What happens next:</h4>
                        <p id="modal-next-steps-text">Select a contest above, then click the button below to send the PDF via email.</p>
                    </div>   
                    
                    <input type="file" id="statement-pdf" accept=".pdf, application/pdf" style="display:none;"/>

                </div>
            </div>

            

            <div class="modal-footer">
                <button class="modal-button modal-button-secondary" id="modal-cancel">Cancel</button>
                <button class="modal-button modal-button-primary" id="modal-submit">Submit</button>
            </div>
        </div>
    </div>
    
    <script>
        // Global data storage
        let contestList = {};
        let contestStatus = [];
        let processedData = {};

        // Parse TSV data
        function parseTSV(text) {
            const rows = text.trim().split('\n').map(row => row.split('\t'));
            const headers = rows[0];
            return rows.slice(1).map(row => {
                const obj = {};
                headers.forEach((header, index) => obj[header] = row[index]);
                return obj;
            });
        }

        // Calculate progress percentages
        function calculateProgress(contests) {
            const total = contests.length;
            if (total === 0) return { stmt: 0, data: 0, sol: 0, pkg: 0 };
            
            const stmt = contests.filter(c => c.statements === 'TRUE').length;
            const data = contests.filter(c => c.data === 'TRUE').length;
            const sol = contests.filter(c => c.solutions === 'TRUE').length;
            const pkg = contests.filter(c => c.packages === 'TRUE').length;
            
            return {
                stmt: Math.round((stmt / total) * 100),
                data: Math.round((data / total) * 100),
                sol: Math.round((sol / total) * 100),
                pkg: Math.round((pkg / total) * 100)
            };
        }

        // Get badge class based on percentage
        function getBadgeClass(percentage) {
            if (percentage === 100) return 'badge-complete';
            if (percentage > 0) return 'badge-partial';
            return 'badge-missing';
        }

        // Create progress badges HTML
        function createProgressBadges(progress, contestData = null, badgeContext = 'region') {
            const createClickableBadge = (type, percentage, label) => {
                if (percentage === 100) {
                    return `<span class="badge ${getBadgeClass(percentage)}">${label} ${percentage}%</span>`;
                } else {
                    // Make badge clickable when not 100%
                    const contestDataAttr = contestData ? ` data-contest-data='${JSON.stringify(contestData)}'` : '';
                    return `<span class="badge ${getBadgeClass(percentage)} clickable-badge" data-badge-type="${type}" data-badge-context="${badgeContext}"${contestDataAttr}>${label} ${percentage}%</span>`;
                }
            };

            return `
                ${createClickableBadge('stmt', progress.stmt, 'Stmt')}
                ${createClickableBadge('data', progress.data, 'Data')}
                ${createClickableBadge('sol', progress.sol, 'Sol')}
                ${createClickableBadge('pkg', progress.pkg, 'Pkg')}
            `;
        }

        // Build contest tree HTML
        function buildContestTree() {
            const treeContainer = document.getElementById('contest-hierarchy');
            treeContainer.innerHTML = '';

            // Define region order
            const regionOrder = ['International', 'North America', 'Europe'];
            
            // Group contests by region
            const regions = {};
            Object.keys(processedData).forEach(key => {
                const contest = processedData[key];
                const region = contest.region;
                
                if (!regions[region]) {
                    regions[region] = {};
                }
                
                // Use shortName as the key to group all years of the same contest type
                const shortName = key.includes('_') ? key.split('_')[0] : key;
                
                if (!regions[region][shortName]) {
                    regions[region][shortName] = {
                        fullName: contest.fullName,
                        shortName: shortName,
                        contests: []
                    };
                }
                
                regions[region][shortName].contests.push(contest);
            });

            // Create HTML for each region in order
            regionOrder.forEach(region => {
                if (!regions[region]) return;
                
                const regionData = regions[region];
                const regionDiv = document.createElement('div');
                regionDiv.className = 'region-section';

                // Calculate region totals
                let totalContests = 0;
                let totalProblems = 0;
                Object.values(regionData).forEach(category => {
                    totalContests += category.contests.length;
                    totalProblems += category.contests.reduce((sum, c) => sum + parseInt(c.count || 0), 0);
                });

                // Calculate region progress
                const allRegionContests = Object.values(regionData).flatMap(cat => cat.contests);
                const regionProgress = calculateProgress(allRegionContests);

                // Create region header
                const regionHeader = document.createElement('div');
                regionHeader.className = 'region-header';
                regionHeader.onclick = () => toggleRegion(regionHeader);
                regionHeader.setAttribute('role', 'button');
                regionHeader.setAttribute('tabindex', '0');
                regionHeader.innerHTML = `
                    <h3>${region}</h3>
                    <div class="region-stats">
                        <span>${totalContests} contests</span>
                        <span>${totalProblems} problems</span>
                        <div class="progress-badges">
                            ${createProgressBadges(regionProgress)}
                        </div>
                    </div>
                `;

                // Create contests list
                const contestsList = document.createElement('ul');
                contestsList.className = 'region-contests';

                // Add contests - sort by year (most recent first)
                Object.entries(regionData).forEach(([key, category]) => {
                    // Sort contests by year (most recent first)
                    category.contests.sort((a, b) => b.year - a.year);
                    
                    const subcategoryProgress = calculateProgress(category.contests);
                    const totalProblems = category.contests.reduce((sum, c) => sum + parseInt(c.count || 0), 0);

                    // Debug: Log the actual data being used
                    console.log(`   Contest: ${category.fullName}`);
                    console.log(`   Contests: ${category.contests.length}`);
                    console.log(`   Progress: Stmt=${subcategoryProgress.stmt}%, Data=${subcategoryProgress.data}%, Sol=${subcategoryProgress.sol}%, Pkg=${subcategoryProgress.pkg}%`);
                    category.contests.forEach(contest => {
                        console.log(`   ${contest.year}: Stmt=${contest.statements}, Data=${contest.data}, Sol=${contest.solutions}, Pkg=${contest.packages}`);
                    });

                    const contestItem = document.createElement('li');
                    contestItem.className = 'contest-item';

                    const contestHeader = document.createElement('div');
                    contestHeader.className = 'contest-header';
                    contestHeader.onclick = () => toggleContest(contestHeader);
                    contestHeader.setAttribute('role', 'button');
                    contestHeader.setAttribute('tabindex', '0');
                    contestHeader.setAttribute('aria-expanded', 'false');
                    contestHeader.innerHTML = `
                        <div class="contest-info">
                            <div class="contest-name">${category.fullName}</div>
                            <div class="contest-meta">${category.contests.length} contests • ${totalProblems} problems</div>
                        </div>
                        <div class="contest-progress">
                            <div class="progress-badges">
                                ${createProgressBadges(subcategoryProgress, category, 'contest')}
                            </div>
                        </div>
                    `;

                    // Create years list container
                    const yearsListContainer = document.createElement('div');
                    yearsListContainer.className = 'years-list-container';
                    // Initially hidden via CSS, no inline style needed

                    // Create years list
                    const yearsList = document.createElement('ul');
                    yearsList.className = 'years-list';

                    // Add individual year items
                    category.contests.forEach(contest => {
                        const yearItem = document.createElement('li');
                        yearItem.className = 'year-item';

                        const yearHeader = document.createElement('div');
                        yearHeader.className = 'year-header';
                        yearHeader.onclick = () => toggleYear(yearHeader);
                        yearHeader.setAttribute('role', 'button');
                        yearHeader.setAttribute('tabindex', '0');
                        yearHeader.setAttribute('aria-expanded', 'false');
                        yearHeader.innerHTML = `
                            <div class="year-info">
                                <span class="year-badge">${contest.year}</span>
                                <span class="year-name">${contest.fullName}</span>
                                <span class="year-problems">${contest.count} problems</span>
                            </div>
                            <div class="year-progress">
                                <div class="progress-badges">
                                    ${createProgressBadges(calculateProgress([contest]), contest, 'year')}
                                </div>
                            </div>
                        `;

                        // Create problem table container for this year
                        const problemTableContainer = document.createElement('div');
                        problemTableContainer.className = 'problem-table-container';
                        const problemTable = createProblemTable(contest);
                        problemTableContainer.appendChild(problemTable);

                        yearItem.appendChild(yearHeader);
                        yearItem.appendChild(problemTableContainer);
                        yearsList.appendChild(yearItem);
                    });

                    yearsListContainer.appendChild(yearsList);
                    contestItem.appendChild(contestHeader);
                    contestItem.appendChild(yearsListContainer);
                    contestsList.appendChild(contestItem);
                    
                    console.log(`Created contest item for ${category.fullName} with ${category.contests.length} years`);
                });

                regionDiv.appendChild(regionHeader);
                regionDiv.appendChild(contestsList);
                treeContainer.appendChild(regionDiv);
            });

            // Initialize with first region expanded
            const firstRegion = treeContainer.querySelector('.region-section');
            if (firstRegion) {
                const firstHeader = firstRegion.querySelector('.region-header');
                const firstList = firstRegion.querySelector('.region-contests');
                firstList.style.display = 'block';
                firstHeader.setAttribute('aria-expanded', 'true');
            }
        }

        // Create problem table for a specific contest
        function createProblemTable(contest) {
            const tableContainer = document.createElement('div');
            tableContainer.className = 'problem-table-wrapper';
            
            const tableTitle = document.createElement('h4');
            tableTitle.textContent = `${contest.fullName}`;
            tableTitle.style.cssText = 'margin: 0 0 16px 0; color: #020817; font-size: 1rem;';
            tableContainer.appendChild(tableTitle);

            const table = document.createElement('table');
            table.className = 'problem-table';
            
            // Create table header
            const thead = document.createElement('thead');
            thead.innerHTML = `
                <tr>
                    <th>Problem</th>
                    <th>Title</th>
                    <th>Statement</th>
                    <th>Data</th>
                    <th>Solution</th>
                    <th>Package</th>
                    <th>OJ Links</th>
                    <th>Last Updated</th>
                </tr>
            `;
            table.appendChild(thead);

            // Create table body with actual contest data
            const tbody = document.createElement('tbody');
            
            // Get actual completion status from contest data
            const hasStatement = contest.statements === 'TRUE';
            const hasData = contest.data === 'TRUE';
            const hasSolution = contest.solutions === 'TRUE';
            const hasPackage = contest.packages === 'TRUE';
            
            // Use actual problem count from contest data
            const problemCount = parseInt(contest.count) || 0;
            
            // Create problem rows based on actual count
            for (let i = 0; i < problemCount; i++) {
                const problemLetter = String.fromCharCode(65 + i); // A, B, C, etc.
                const row = document.createElement('tr');
                
                // Use actual completion status from TSV data for all problems in the contest
                // In a real implementation, you might have per-problem data
                const hasOJLink = Math.random() > 0.7; // OJ links would come from separate data
                
                // Generate last updated time based on actual completion status
                const lastUpdated = generateLastUpdated(hasStatement, hasData, hasSolution, hasPackage);
                
                row.innerHTML = `
                    <td class="problem-name">${problemLetter}</td>
                    <td class="problem-title">Problem ${problemLetter}</td>
                    <td class="status-cell">${hasStatement ? '<span class="status-icon"></span>' : '<span class="status-empty"></span>'}</td>
                    <td class="status-cell">${hasData ? '<span class="status-icon"></span>' : '<span class="status-empty"></span>'}</td>
                    <td class="status-cell">${hasSolution ? '<span class="status-icon"></span>' : '<span class="status-empty"></span>'}</td>
                    <td class="status-cell">${hasPackage ? '<span class="status-icon"></span>' : '<span class="status-empty"></span>'}</td>
                    <td class="status-cell">${hasOJLink ? '<span class="link-icon"></span>' : '<span class="status-empty"></span>'}</td>
                    <td class="last-updated">${lastUpdated}</td>
                `;
                
                tbody.appendChild(row);
            }
            
            table.appendChild(tbody);
            tableContainer.appendChild(table);
            
            return tableContainer;
        }

        // Generate last updated time based on completion status
        function generateLastUpdated(hasStatement, hasData, hasSolution, hasPackage) {
            const isComplete = hasStatement && hasData && hasSolution && hasPackage;
            const isPartial = hasStatement || hasData || hasSolution || hasPackage;
            
            if (isComplete) {
                const times = ['2 hours ago', '1 day ago', '3 days ago', '1 week ago'];
                return times[Math.floor(Math.random() * times.length)];
            } else if (isPartial) {
                const times = ['1 week ago', '2 weeks ago', '1 month ago', '3 months ago'];
                return times[Math.floor(Math.random() * times.length)];
            } else {
                const times = ['6 months ago', '1 year ago', '2 years ago'];
                return times[Math.floor(Math.random() * times.length)];
            }
        }

        // Toggle region visibility
        function toggleRegion(headerElement) {
            const region = headerElement.closest('.region-section');
            const contestsList = region.querySelector('.region-contests');
            const isExpanded = contestsList.style.display === 'block';
            
            if (isExpanded) {
                contestsList.style.display = 'none';
                headerElement.setAttribute('aria-expanded', 'false');
            } else {
                contestsList.style.display = 'block';
                headerElement.setAttribute('aria-expanded', 'true');
            }
        }

        // Toggle contest years list
        function toggleContest(headerElement) {
            const contestItem = headerElement.closest('.contest-item');
            const yearsListContainer = contestItem.querySelector('.years-list-container');
            const isExpanded = yearsListContainer.classList.contains('expanded');
            
            console.log('Toggle contest clicked:', isExpanded ? 'collapsing' : 'expanding');
            console.log('Years list container found:', !!yearsListContainer);
            
            if (isExpanded) {
                yearsListContainer.classList.remove('expanded');
                headerElement.setAttribute('aria-expanded', 'false');
                console.log('Removed expanded class from years list');
            } else {
                yearsListContainer.classList.add('expanded');
                headerElement.setAttribute('aria-expanded', 'true');
                console.log('Added expanded class to years list');
            }
        }

        // Toggle year problem table
        function toggleYear(headerElement) {
            const yearItem = headerElement.closest('.year-item');
            const problemTableContainer = yearItem.querySelector('.problem-table-container');
            const isExpanded = problemTableContainer.classList.contains('expanded');
            
            console.log('Toggle year clicked:', isExpanded ? 'collapsing' : 'expanding');
            console.log('Problem table container found:', !!problemTableContainer);
            
            if (isExpanded) {
                problemTableContainer.classList.remove('expanded');
                headerElement.setAttribute('aria-expanded', 'false');
                console.log('Removed expanded class from problem table');
            } else {
                problemTableContainer.classList.add('expanded');
                headerElement.setAttribute('aria-expanded', 'true');
                console.log('Added expanded class to problem table');
            }
        }

        // Load and process data
        async function loadContestData() {
            try {
                console.log('Starting data load...');
                
                // Load contest list
                console.log('Loading ContestList.tsv...');
                const contestListResponse = await fetch('ContestList.tsv?v=' + Date.now());
                if (!contestListResponse.ok) throw new Error('ContestList.tsv not found');
                const contestListText = await contestListResponse.text();
                const contestListData = parseTSV(contestListText);
                console.log('ContestList loaded:', contestListData.length, 'contests');

                // Create contest lookup
                contestList = contestListData.reduce((acc, item) => {
                    acc[item['short-name']] = {
                        fullName: item['full-name'],
                        region: item['region-name']
                    };
                    return acc;
                }, {});
                console.log('Contest lookup created:', Object.keys(contestList).length, 'entries');

                // Load contest status
                console.log('Loading ContestStatus.tsv...');
                const statusResponse = await fetch('ContestStatus.tsv?v=' + Date.now());
                if (!statusResponse.ok) throw new Error('ContestStatus.tsv not found');
                const statusText = await statusResponse.text();
                const statusData = parseTSV(statusText);
                console.log('ContestStatus loaded:', statusData.length, 'entries');

                // Process and combine data - use only real TSV data
                console.log('Combining data...');
                statusData.forEach(row => {
                    const shortName = row['short-name'];
                    const year = parseInt(row.year);
                    
                    // Filter out invalid data (empty rows, NaN values, etc.)
                    if (!shortName || !shortName.trim() || isNaN(year) || !contestList[shortName]) {
                        return; // Skip this row
                    }
                    
                    // Create unique key for each year
                    const uniqueKey = `${shortName}_${year}`;
                    processedData[uniqueKey] = {
                        ...contestList[shortName],
                        year: year,
                        count: parseInt(row.count) || 0,
                        statements: row.statements,
                        data: row.data,
                        solutions: row.solutions,
                        packages: row.packages
                    };
                    
                    // Debug: Log some sample data
                    if (uniqueKey.includes('wf_2011') || uniqueKey.includes('seerc_2024')) {
                        console.log(`Sample data for ${uniqueKey}:`, processedData[uniqueKey]);
                    }
                });
                console.log('Data combined:', Object.keys(processedData).length, 'processed entries');
                
                // Debug: Show how many entries we have for each contest type
                const contestCounts = {};
                Object.keys(processedData).forEach(key => {
                    const shortName = key.includes('_') ? key.split('_')[0] : key;
                    contestCounts[shortName] = (contestCounts[shortName] || 0) + 1;
                });
                console.log('Contest counts by type:', contestCounts);

                // Build the tree
                console.log('Building contest tree...');
                buildContestTreeWithFilters('all', 'all');
                console.log('Contest tree built successfully!');

                // Store last modification time for auto-refresh
                const lastModified = new Date().toISOString();
                localStorage.setItem('lastDataUpdate', lastModified);
                console.log('Data update timestamp saved:', lastModified);

            } catch (error) {
                console.error('Error loading data:', error);
                const treeContainer = document.getElementById('contest-hierarchy');
                treeContainer.innerHTML = `
                    <div class="error-message">
                        <h3>Error Loading Data</h3>
                        <p>Unable to load contest data: ${error.message}</p>
                        <p>Please ensure the TSV files are available in the project directory.</p>
                    </div>
                `;
            }
        }

        // Check for file changes and auto-refresh
        async function checkForUpdates() {
            try {
                // Check if files have been modified by comparing timestamps
                const lastUpdate = localStorage.getItem('lastDataUpdate');
                if (!lastUpdate) return;

                // Fetch both files to check for changes
                const [contestListResponse, statusResponse] = await Promise.all([
                    fetch('ContestList.tsv', { method: 'HEAD' }),
                    fetch('ContestStatus.tsv', { method: 'HEAD' })
                ]);

                if (contestListResponse.ok && statusResponse.ok) {
                    const contestListModified = contestListResponse.headers.get('last-modified');
                    const statusModified = statusResponse.headers.get('last-modified');
                    
                    // If either file has been modified since last update
                    if (contestListModified || statusModified) {
                        const lastModified = new Date(Math.max(
                            new Date(contestListModified || 0).getTime(),
                            new Date(statusModified || 0).getTime()
                        ));
                        
                        if (new Date(lastUpdate) < lastModified) {
                            console.log('TSV files have been modified, refreshing data...');
                            await loadContestData();
                        }
                    }
                }
            } catch (error) {
                console.log('Could not check for updates:', error.message);
            }
        }

        // Auto-refresh functionality
        function setupAutoRefresh() {
            // Check for updates every 30 seconds
            setInterval(checkForUpdates, 30000);
            
            // Also check when the page becomes visible (user returns to tab)
            document.addEventListener('visibilitychange', () => {
                if (!document.hidden) {
                    checkForUpdates();
                }
            });
        }

        // Build contest tree with filters
        function buildContestTreeWithFilters(missingFilter, regionFilter) {
            console.log('Building contest tree with filters:', { missingFilter, regionFilter });
            
            const treeContainer = document.getElementById('contest-hierarchy');
            treeContainer.innerHTML = '';

            // Define region order
            const regionOrder = ['International', 'North America', 'Europe'];
            
            // Group contests by region
            const regions = {};
            Object.keys(processedData).forEach(key => {
                const contest = processedData[key];
                
                // Additional safety check for invalid data
                if (!contest || !contest.region || !contest.fullName || 
                    isNaN(contest.year) || contest.fullName === 'NaN' || 
                    contest.region === 'NaN' || contest.fullName.trim() === '' || 
                    contest.region.trim() === '') {
                    return; // Skip this contest
                }
                
                const region = contest.region;
                
                // Apply region filter
                if (regionFilter !== 'all' && region !== regionFilter) {
                    return;
                }
                
                if (!regions[region]) {
                    regions[region] = {};
                }
                
                // Use shortName as the key to group all years of the same contest type
                const shortName = key.includes('_') ? key.split('_')[0] : key;
                
                if (!regions[region][shortName]) {
                    regions[region][shortName] = {
                        fullName: contest.fullName,
                        shortName: shortName,
                        contests: []
                    };
                }
                
                regions[region][shortName].contests.push(contest);
            });

            console.log('Grouped regions:', Object.keys(regions));
            console.log('Regions data:', regions);

            // Create HTML for each region in order
            regionOrder.forEach(region => {
                if (!regions[region]) return;
                
                const regionData = regions[region];
                console.log(`Processing region: ${region} with ${Object.keys(regionData).length} contest types`);
                
                const regionDiv = document.createElement('div');
                regionDiv.className = 'region-section';

                // Calculate region totals
                let totalContests = 0;
                let totalProblems = 0;
                Object.values(regionData).forEach(category => {
                    totalContests += category.contests.length;
                    totalProblems += category.contests.reduce((sum, c) => sum + parseInt(c.count || 0), 0);
                });

                // Calculate region progress
                const allRegionContests = Object.values(regionData).flatMap(cat => cat.contests);
                const regionProgress = calculateProgress(allRegionContests);

                // Create region header
                const regionHeader = document.createElement('div');
                regionHeader.className = 'region-header';
                regionHeader.onclick = () => toggleRegion(regionHeader);
                regionHeader.setAttribute('role', 'button');
                regionHeader.setAttribute('tabindex', '0');
                regionHeader.innerHTML = `
                    <h3>${region}</h3>
                    <div class="region-stats">
                        <span>${totalContests} contests</span>
                        <span>${totalProblems} problems</span>
                        <div class="progress-badges">
                            ${createProgressBadges(regionProgress)}
                        </div>
                    </div>
                `;

                // Create contests list
                const contestsList = document.createElement('ul');
                contestsList.className = 'region-contests';

                // Add contests - sort by year (most recent first)
                Object.entries(regionData).forEach(([key, category]) => {
                    // Sort contests by year (most recent first)
                    category.contests.sort((a, b) => b.year - a.year);
                    
                    console.log(`Processing contest: ${category.fullName} with ${category.contests.length} years`);
                    
                    // Apply missing filter - filter individual years that are complete
                    let filteredContests = category.contests;
                    if (missingFilter !== 'all') {
                        console.log(`Filtering contest: ${category.fullName} for missing items (filter: ${missingFilter})`);
                        
                        filteredContests = category.contests.filter(contest => {
                            let isMissing = false;
                            
                            if (missingFilter === 'missing') {
                                // Show any contest with any missing component
                                const stmtMissing = !contest.statements || contest.statements.toString().toUpperCase() !== 'TRUE';
                                const dataMissing = !contest.data || contest.data.toString().toUpperCase() !== 'TRUE';
                                const solMissing = !contest.solutions || contest.solutions.toString().toUpperCase() !== 'TRUE';
                                const pkgMissing = !contest.packages || contest.packages.toString().toUpperCase() !== 'TRUE';
                                isMissing = stmtMissing || dataMissing || solMissing || pkgMissing;
                                
                                console.log(`   ${contest.year}: Stmt=${contest.statements}(${stmtMissing}), Data=${contest.data}(${dataMissing}), Sol=${contest.solutions}(${solMissing}), Pkg=${contest.packages}(${pkgMissing}), Missing=${isMissing}`);
                            } else if (missingFilter === 'statements') {
                                // Show only contests missing statements
                                isMissing = !contest.statements || contest.statements.toString().toUpperCase() !== 'TRUE';
                                console.log(`   ${contest.year}: Stmt=${contest.statements}, Missing=${isMissing}`);
                            } else if (missingFilter === 'data') {
                                // Show only contests missing test data
                                isMissing = !contest.data || contest.data.toString().toUpperCase() !== 'TRUE';
                                console.log(`   ${contest.year}: Data=${contest.data}, Missing=${isMissing}`);
                            } else if (missingFilter === 'solutions') {
                                // Show only contests missing solutions
                                isMissing = !contest.solutions || contest.solutions.toString().toUpperCase() !== 'TRUE';
                                console.log(`   ${contest.year}: Sol=${contest.solutions}, Missing=${isMissing}`);
                            } else if (missingFilter === 'packages') {
                                // Show only contests missing packages
                                isMissing = !contest.packages || contest.packages.toString().toUpperCase() !== 'TRUE';
                                console.log(`   ${contest.year}: Pkg=${contest.packages}, Missing=${isMissing}`);
                            }
                            
                            return isMissing;
                        });
                        
                        console.log(`   Filtered from ${category.contests.length} to ${filteredContests.length} contests`);
                    }
                    
                    // Skip this contest category entirely if no years remain after filtering
                    if (filteredContests.length === 0) {
                        console.log(`Skipping ${category.fullName} - no years remain after filtering`);
                        return;
                    }
                    
                    const subcategoryProgress = calculateProgress(filteredContests);
                    const totalProblems = filteredContests.reduce((sum, c) => sum + parseInt(c.count || 0), 0);

                    const contestItem = document.createElement('li');
                    contestItem.className = 'contest-item';

                    const contestHeader = document.createElement('div');
                    contestHeader.className = 'contest-header';
                    contestHeader.onclick = () => toggleContest(contestHeader);
                    contestHeader.setAttribute('role', 'button');
                    contestHeader.setAttribute('tabindex', '0');
                    contestHeader.setAttribute('aria-expanded', 'false');
                    contestHeader.innerHTML = `
                        <div class="contest-info">
                            <div class="contest-name">${category.fullName}</div>
                            <div class="contest-meta">${filteredContests.length} contests • ${totalProblems} problems</div>
                        </div>
                        <div class="contest-progress">
                            <div class="progress-badges">
                                ${createProgressBadges(subcategoryProgress, category, 'contest')}
                            </div>
                        </div>
                    `;

                    // Create years list container
                    const yearsListContainer = document.createElement('div');
                    yearsListContainer.className = 'years-list-container';

                    // Create years list
                    const yearsList = document.createElement('ul');
                    yearsList.className = 'years-list';

                    // Add individual year items (using filtered contests)
                    filteredContests.forEach(contest => {
                        const yearItem = document.createElement('li');
                        yearItem.className = 'year-item';

                        const yearHeader = document.createElement('div');
                        yearHeader.className = 'year-header';
                        yearHeader.onclick = () => toggleYear(yearHeader);
                        yearHeader.setAttribute('role', 'button');
                        yearHeader.setAttribute('tabindex', '0');
                        yearHeader.setAttribute('aria-expanded', 'false');
                        yearHeader.innerHTML = `
                            <div class="year-info">
                                <span class="year-badge">${contest.year}</span>
                                <span class="year-name">${contest.fullName}</span>
                                <span class="year-problems">${contest.count} problems</span>
                            </div>
                            <div class="year-progress">
                                <div class="progress-badges">
                                    ${createProgressBadges(calculateProgress([contest]), contest, 'year')}
                                </div>
                            </div>
                        `;

                        // Create problem table container for this year
                        const problemTableContainer = document.createElement('div');
                        problemTableContainer.className = 'problem-table-container';
                        const problemTable = createProblemTable(contest);
                        problemTableContainer.appendChild(problemTable);

                        yearItem.appendChild(yearHeader);
                        yearItem.appendChild(problemTableContainer);
                        yearsList.appendChild(yearItem);
                    });

                    yearsListContainer.appendChild(yearsList);
                    contestItem.appendChild(contestHeader);
                    contestItem.appendChild(yearsListContainer);
                    contestsList.appendChild(contestItem);
                });

                regionDiv.appendChild(regionHeader);
                regionDiv.appendChild(contestsList);
                treeContainer.appendChild(regionDiv);
            });

            // Initialize with first region expanded
            const firstRegion = treeContainer.querySelector('.region-section');
            if (firstRegion) {
                const firstHeader = firstRegion.querySelector('.region-header');
                const firstList = firstRegion.querySelector('.region-contests');
                firstList.style.display = 'block';
                firstHeader.setAttribute('aria-expanded', 'true');
            }
            
            console.log('Contest tree built successfully!');
            console.log('Final tree structure:', treeContainer.innerHTML.substring(0, 200) + '...');
        }
        

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load data
            loadContestData();
            
            // Setup auto-refresh
            setupAutoRefresh();

            // Add keyboard navigation
            document.addEventListener('keydown', function(event) {
                if (event.target.classList.contains('region-header') || 
                    event.target.classList.contains('contest-header') ||
                    event.target.classList.contains('year-header')) {
                    if (event.key === 'Enter' || event.key === ' ') {
                        event.preventDefault();
                        if (event.target.classList.contains('region-header')) {
                            toggleRegion(event.target);
                        } else if (event.target.classList.contains('contest-header')) {
                            toggleContest(event.target);
                        } else if (event.target.classList.contains('year-header')) {
                            toggleYear(event.target);
                        }
                    }
                }
            });

            // Filter functionality
            document.getElementById('missing-filter').addEventListener('change', function() {
                applyFilters();
            });

            document.getElementById('region-filter').addEventListener('change', function() {
                applyFilters();
            });

            // Apply filters to the contest tree
            function applyFilters() {
                const missingFilter = document.getElementById('missing-filter').value;
                const regionFilter = document.getElementById('region-filter').value;
                
                console.log('Applying filters:', { missingFilter, regionFilter });
                console.log('Total processed data entries:', Object.keys(processedData).length);
                console.log('Sample processed data:', Object.keys(processedData).slice(0, 5).map(key => ({ key, data: processedData[key] })));
                
                // Rebuild the tree with filters applied
                buildContestTreeWithFilters(missingFilter, regionFilter);
            }

            // Scroll-based navigation highlighting
            function updateActiveNavigation() {
                const sections = [
                    { id: 'progress', element: document.getElementById('progress') },
                    { id: 'contributors', element: document.getElementById('contributors') },
                    { id: 'help', element: document.getElementById('help') },
                    { id: 'contact', element: document.getElementById('contact') }
                ];
                
                const navItems = document.querySelectorAll('.nav-item');
                const scrollPosition = window.scrollY + 100; // Offset for sticky nav
                const windowHeight = window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight;
                
                let activeSection = null;
                
                sections.forEach((section, index) => {
                    if (section.element) {
                        const sectionTop = section.element.offsetTop;
                        const sectionBottom = sectionTop + section.element.offsetHeight;
                        const isLastSection = index === sections.length - 1;
                        
                        // For the last section (contact), also check if we're near the bottom of the page
                        if (isLastSection) {
                            const isNearBottom = scrollPosition + windowHeight >= documentHeight - 50; // 50px threshold
                            if (scrollPosition >= sectionTop || isNearBottom) {
                                activeSection = section.id;
                            }
                        } else {
                            // For other sections, use the original logic
                            if (scrollPosition >= sectionTop && scrollPosition < sectionBottom) {
                                activeSection = section.id;
                            }
                        }
                    }
                });
                
                // Update navigation items
                navItems.forEach(item => {
                    item.classList.remove('active');
                    const href = item.getAttribute('href');
                    if (href && href.includes(activeSection)) {
                        item.classList.add('active');
                    }
                });
                
                // If no section is active and we're at the top, highlight the first nav item
                if (!activeSection && scrollPosition < 200) {
                    navItems.forEach(item => item.classList.remove('active'));
                    navItems[0].classList.add('active');
                }
            }

            // Add scroll event listener
            window.addEventListener('scroll', updateActiveNavigation);
            
            // Initial call to set correct active state
            updateActiveNavigation();

            // Modal functionality
            const modalOverlay = document.getElementById('modal-overlay');
            const modalClose = document.getElementById('modal-close');
            const modalCancel = document.getElementById('modal-cancel');
            const modalSubmit = document.getElementById('modal-submit');
            const modalTitle = document.getElementById('modal-title');
            const modalDescription = document.getElementById('modal-description');
            const modalLabelTag = document.getElementById('modal-label-tag');
            const modalNextSteps = document.getElementById('modal-next-steps-text');
            const contestSelect = document.getElementById('contest-select');
            const modalIcon = document.getElementById('modal-icon');
            

            // SVG icons for different submission types
            const modalIcons = {
                'statements': `<path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              <path d="M14 2V8H20" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              <path d="M16 13H8" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              <path d="M16 17H8" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              <path d="M10 9H9H8" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>`,
                'data': `<path d="M8 3H5C4.46957 3 3.96086 3.21071 3.58579 3.58579C3.21071 3.96086 3 4.46957 3 5V19C3 19.5304 3.21071 20.0391 3.58579 20.4142C3.96086 20.7893 4.46957 21 5 21H19C19.5304 21 20.0391 20.7893 20.4142 20.4142C20.7893 20.0391 21 19.5304 21 19V16" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M15 2H21V8" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M7 7L17 17" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M17 7L7 17" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>`,
                'solutions': `<path d="M9 12L11 14L15 10" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                             <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>`,
                'packages': `<path d="M20 7L12 3L4 7M20 7V17L12 21L4 17V7M20 7L12 11L4 7" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12 11V21" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>`,
                'create-packages': `<path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                   <path d="M2 17L12 22L22 17" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                   <path d="M2 12L12 17L22 12" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                   <path d="M12 2V12" stroke="#020817" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>`
            };

            // Modal configuration for different types
            const modalConfigs = {
                'statements': {
                    title: 'Submit Problem Statements',
                    description: 'Help us by providing the official problem statement PDF',
                    nextSteps: 'Select a contest (or specific year) above, then click the button below to attach your problem statement PDF.',
                    filterType: 'statements'
                },
                'data': {
                    title: 'Submit Test Data',
                    description: 'Help us by providing test cases and input/output data',
                    nextSteps: 'Select a contest above, then click the button below to request access to a GitHub repository. When you get access, add the data to the repository.',
                    filterType: 'data'
                },
                'solutions': {
                    title: 'Submit Solutions',
                    description: 'Help us by providing solution code and editorial explanations',
                    nextSteps: 'Select a contest above, then click the button below to request access to a GitHub repository. When you get access, add the solutions to the repository.',
                    filterType: 'solutions'
                },
                'packages': {
                    title: 'Submit Packages',
                    description: 'Help us by providing complete problem packages in standard formats',
                    nextSteps: 'Select a contest above, then click the button below to request access to a GitHub repository. When you get access, add the packages to the repository.',
                    filterType: 'packages'
                },
                'create-packages': {
                    title: 'Help Create Problem Packages',
                    description: 'Help us create problem packages when we have statements, data, and solutions',
                    nextSteps: 'Select a contest (or specific year) above, then click the button below to volunteer for package creation.',
                    filterType: 'packages'
                }
            };

            // Function to show modal
            function showModal(type) {
                const config = modalConfigs[type];
                if (!config) return;

                // Update modal content
                modalTitle.textContent = config.title;
                modalDescription.textContent = config.description;
                modalNextSteps.textContent = config.nextSteps;

                if (type == 'statements') {
                    document.getElementById('statement-pdf').style.display = 'block';
                }
                
                // Show/hide GitHub username field for test data, solutions, and packages modals
                const githubField = document.getElementById('github-username-field');
                if (type === 'data' || type === 'solutions' || type === 'packages') {
                    githubField.style.display = 'block';
                } else {
                    githubField.style.display = 'none';
                }


                // Hide badge for all modals
                const badgeContainer = document.getElementById('form-label-container');
                badgeContainer.style.display = 'none';

                // Update modal icon
                if (modalIcons[type]) {
                    modalIcon.innerHTML = modalIcons[type];
                }

                // Populate contest select with missing items
                populateContestSelect(config.filterType);

                // Disable submit button initially
                const submitButton = document.getElementById('modal-submit');
                submitButton.disabled = true;

                // Show modal
                modalOverlay.classList.add('show');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            }

            // Function to show modal with a specific contest pre-selected
            function showModalWithContest(type, contest) {
                const config = modalConfigs[type];
                if (!config) return;

                // Update modal content
                modalTitle.textContent = config.title;
                
                // For problem statements modal, adjust text based on contest type
                if (type === 'statements') {
                    document.getElementById('statement-pdf').style.display = 'block';
                    if (contest.isGeneralContest) {
                        modalDescription.textContent = 'Help us by providing the official problem statement PDFs';
                        modalNextSteps.textContent = 'Click the button below to upload problem statements. If you have multiple PDFs, please combine them into one file.';
                    } else {
                        modalDescription.textContent = config.description;
                        modalNextSteps.textContent = config.nextSteps;
                    }
                } else {
                    modalDescription.textContent = config.description;
                    modalNextSteps.textContent = config.nextSteps;
                }

                // Show/hide GitHub username field for test data, solutions, and packages modals
                const githubField = document.getElementById('github-username-field');
                if (type === 'data' || type === 'solutions' || type === 'packages') {
                    githubField.style.display = 'block';
                } else {
                    githubField.style.display = 'none';
                }

                // Hide badge for all modals
                const badgeContainer = document.getElementById('form-label-container');
                badgeContainer.style.display = 'none';

                // Update modal icon
                if (modalIcons[type]) {
                    modalIcon.innerHTML = modalIcons[type];
                }

                // Populate contest select with missing items
                populateContestSelect(config.filterType);

                // Handle different types of contest selections
                if (contest.isGeneralContest) {
                    // For general contest selections (contest-level badges), we need to create a group option
                    // Wait for the contest select to be populated, then add our general contest option
                    setTimeout(() => {
                        const contestSelect = document.getElementById('contest-select');
                        if (contestSelect) {
                            // Create a group option for the general contest
                            const groupOption = document.createElement('option');
                            groupOption.value = `group_${contest.fullName.replace(/\s+/g, '_')}_${contest.region.replace(/\s+/g, '_')}`;
                            groupOption.textContent = `${contest.fullName} - ${contest.region}`;
                            
                            // Insert at the top (after the default option)
                            contestSelect.insertBefore(groupOption, contestSelect.children[1]);
                            
                            // Select this option
                            contestSelect.value = groupOption.value;
                            
                            // Enable submit button if this modal doesn't require GitHub username
                            if (type !== 'data' && type !== 'solutions' && type !== 'packages') {
                                const submitButton = document.getElementById('modal-submit');
                                submitButton.disabled = false;
                            }
                        }
                    }, 100); // Small delay to ensure populateContestSelect has finished
                } else {
                    // For specific year selections, find the contest key as before
                    const contestKey = Object.keys(processedData).find(key => {
                        const data = processedData[key];
                        return data.fullName === contest.fullName && data.year === contest.year && data.region === contest.region;
                    });

                    if (contestKey && contestSelect.value !== contestKey) {
                        contestSelect.value = contestKey;
                        // For solutions and packages modals, submit button should still be disabled until GitHub username is provided
                        if (type === 'solutions' || type === 'packages') {
                            const submitButton = document.getElementById('modal-submit');
                            submitButton.disabled = true;
                        } else {
                            const submitButton = document.getElementById('modal-submit');
                            submitButton.disabled = false;
                        }
                    }
                }

                // Show modal
                modalOverlay.classList.add('show');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            }

            // Function to hide modal
            function hideModal() {
                modalOverlay.classList.remove('show');
                document.body.style.overflow = ''; // Restore scrolling
                contestSelect.value = ''; // Reset select
                document.getElementById('statement-pdf').style.display = 'none'; // reset file input visibility
                
                // Reset GitHub username field
                const githubUsername = document.getElementById('github-username');
                if (githubUsername) {
                    githubUsername.value = '';
                    githubUsername.classList.remove('valid', 'invalid');
                    const validationMessage = document.getElementById('github-validation-message');
                    if (validationMessage) {
                        validationMessage.textContent = '';
                        validationMessage.className = 'validation-message';
                    }
                }
                
                // Disable submit button when hiding modal
                const submitButton = document.getElementById('modal-submit');
                submitButton.disabled = true;
            }

            // Function to populate contest select with missing items
            function populateContestSelect(filterType) {
                // Clear existing options
                contestSelect.innerHTML = '<option value="">Choose a contest...</option>';
                
                // Disable submit button when populating
                const submitButton = document.getElementById('modal-submit');
                submitButton.disabled = true;
                
                // Reset GitHub username field when populating
                const githubUsername = document.getElementById('github-username');
                if (githubUsername) {
                    githubUsername.value = '';
                    githubUsername.classList.remove('valid', 'invalid');
                    const validationMessage = document.getElementById('github-validation-message');
                    if (validationMessage) {
                        validationMessage.textContent = '';
                        validationMessage.className = 'validation-message';
                    }
                }

                // Get contests missing the specified type
                const missingContests = [];
                const contestGroups = {};
                
                console.log(`Populating contest select for filter type: ${filterType}`);
                console.log(`Total processed data entries: ${Object.keys(processedData).length}`);
                
                Object.keys(processedData).forEach(key => {
                    const contest = processedData[key];
                    
                    // Filter out contests with invalid data (NaN, undefined, empty strings)
                    if (!contest || !contest.fullName || !contest.region || 
                        isNaN(contest.year) || contest.fullName === 'NaN' || 
                        contest.region === 'NaN' || contest.fullName.trim() === '' || 
                        contest.region.trim() === '') {
                        return; // Skip this contest
                    }
                    
                    // More robust checking for TRUE values
                    const fieldValue = contest[filterType];
                    const isMissing = !fieldValue || fieldValue.toString().toUpperCase() !== 'TRUE';
                    
                    if (isMissing) {
                        // Include the year in the contest data
                        missingContests.push({
                            key: key,
                            shortName: key.includes('_') ? key.split('_')[0] : key,
                            fullName: contest.fullName,
                            region: contest.region,
                            year: contest.year
                        });
                        
                        // Group contests by name for overall contest options
                        const contestName = contest.fullName;
                        if (!contestGroups[contestName]) {
                            contestGroups[contestName] = {
                                fullName: contest.fullName,
                                region: contest.region,
                                years: [],
                                missingYears: []
                            };
                        }
                        contestGroups[contestName].years.push(contest.year);
                        contestGroups[contestName].missingYears.push(contest.year);
                    }
                });

                console.log(`Found ${missingContests.length} contests missing ${filterType}`);

                // Sort by region, then by name, then by year (most recent first)
                missingContests.sort((a, b) => {
                    const regionOrder = { 'International': 1, 'North America': 2, 'Europe': 3 };
                    const regionDiff = (regionOrder[a.region] || 4) - (regionOrder[b.region] || 4);
                    if (regionDiff !== 0) return regionDiff;
                    
                    const nameDiff = a.fullName.localeCompare(b.fullName);
                    if (nameDiff !== 0) return nameDiff;
                    
                    return b.year - a.year; // Most recent year first
                });

                // Add overall contest options first (grouped by name)
                Object.values(contestGroups).forEach(group => {
                    const option = document.createElement('option');
                    option.value = `group_${group.fullName}_${group.region}`;
                    option.textContent = `${group.fullName} - ${group.region}`;
                    option.className = 'contest-group-header'; // Add class for styling
                    contestSelect.appendChild(option);
                    
                    // Add individual year options under this contest
                    group.missingYears.sort((a, b) => b - a).forEach(year => {
                        const yearContest = missingContests.find(c => c.fullName === group.fullName && c.year === year);
                        if (yearContest) {
                            const option = document.createElement('option');
                            option.value = yearContest.key;
                            option.textContent = `${yearContest.fullName} ${yearContest.year} - ${yearContest.region}`;
                            contestSelect.appendChild(option);
                        }
                    });
                });
                
                console.log(`Added ${Object.keys(contestGroups).length} contest groups and ${missingContests.length} individual year options to select dropdown`);
            }

            // Event listeners for modal
            modalClose.addEventListener('click', hideModal);
            modalCancel.addEventListener('click', hideModal);
            
            // Contest select change event to enable/disable submit button
            contestSelect.addEventListener('change', function() {
                validateForm();
            });

            // Function to validate form and enable/disable submit button
            function validateForm() {
                const submitButton = document.getElementById('modal-submit');
                const contestSelected = contestSelect.value && contestSelect.value.trim() !== '';
                
                // For test data, solutions, and packages modals, also check GitHub username
                const modalTitle = document.getElementById('modal-title').textContent;
                if (modalTitle === 'Submit Test Data' || modalTitle === 'Submit Solutions' || modalTitle === 'Submit Packages') {
                    const githubUsername = document.getElementById('github-username').value.trim();
                    const githubValid = githubUsername && githubUsername.length > 0;
                    submitButton.disabled = !(contestSelected && githubValid);
                } 
                else if (modalTitle === 'Submit Problem Statements'){
                    const statementPDF = document.getElementById('statement-pdf');
                    submitButton.disabled = !((statementPDF.files && statementPDF.files.length > 0) && contestSelected)

                }
                else {
                    submitButton.disabled = !contestSelected;
                }
            }

            const statementPDF = document.getElementById('statement-pdf');
            statementPDF.addEventListener('change', () => {
                if (statementPDF && statementPDF.files.length > 0){
                    validateForm();
                }
            })
            
            // GitHub username blur event for validation (when user finishes typing)
            document.addEventListener('blur', async function(e) {
                if (e.target.id === 'github-username') {
                    const username = e.target.value.trim();
                    if (username) {
                        await validateGitHubUsername(username);
                        validateForm();
                    }
                }
            }, true);
            
            // GitHub username input event for real-time format validation
            document.addEventListener('input', function(e) {
                if (e.target.id === 'github-username') {
                    validateForm();
                    // Only do basic format validation on input, not API call
                    const username = e.target.value.trim();
                    if (username) {
                        const githubRegex = /^[a-z\d](?:[a-z\d]|-(?=[a-z\d])){0,38}$/i;
                        const isValid = githubRegex.test(username);
                        
                        const validationMessage = document.getElementById('github-validation-message');
                        const input = document.getElementById('github-username');
                        
                        if (isValid) {
                            validationMessage.textContent = '✓ Format valid, checking GitHub...';
                            validationMessage.className = 'validation-message valid';
                            input.classList.remove('invalid');
                            input.classList.add('valid');
                        } else {
                            validationMessage.textContent = '✗ Invalid GitHub username format';
                            validationMessage.className = 'validation-message invalid';
                            input.classList.remove('valid');
                            input.classList.add('invalid');
                        }
                    }
                }
            });
            
            // Function to validate GitHub username using GitHub API
            async function validateGitHubUsername(username) {
                const validationMessage = document.getElementById('github-validation-message');
                const input = document.getElementById('github-username');
                
                if (!username || username.trim() === '') {
                    validationMessage.textContent = '';
                    input.classList.remove('valid', 'invalid');
                    return;
                }
                
                // GitHub username validation rules
                const githubRegex = /^[a-z\d](?:[a-z\d]|-(?=[a-z\d])){0,38}$/i;
                const isValid = githubRegex.test(username);
                
                if (!isValid) {
                    validationMessage.textContent = '✗ Invalid GitHub username format';
                    validationMessage.className = 'validation-message invalid';
                    input.classList.remove('valid');
                    input.classList.add('invalid');
                    return;
                }
                
                // Show loading state
                validationMessage.textContent = '⏳ Checking GitHub username...';
                validationMessage.className = 'validation-message loading';
                input.classList.remove('valid', 'invalid');
                
                try {
                    // Check if GitHub username exists using GitHub API
                    const response = await fetch(`https://api.github.com/users/${username}`);
                    
                    if (response.ok) {
                        // Username exists
                        validationMessage.textContent = '✓ Valid GitHub username';
                        validationMessage.className = 'validation-message valid';
                        input.classList.remove('invalid');
                        input.classList.add('valid');
                    } else if (response.status === 404) {
                        // Username does not exist
                        validationMessage.textContent = '✗ GitHub username does not exist';
                        validationMessage.className = 'validation-message invalid';
                        input.classList.remove('valid');
                        input.classList.add('invalid');
                    } else {
                        // API error
                        validationMessage.textContent = '⚠ Unable to verify username (API error)';
                        validationMessage.className = 'validation-message warning';
                        input.classList.remove('valid', 'invalid');
                    }
                } catch (error) {
                    // Network error
                    validationMessage.textContent = '⚠ Unable to verify username (network error)';
                    validationMessage.className = 'validation-message warning';
                    input.classList.remove('valid', 'invalid');
                }
            }
            
            // Close modal when clicking overlay
            modalOverlay.addEventListener('click', function(e) {
                if (e.target === modalOverlay) {
                    hideModal();
                }
            });

            // Close modal with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modalOverlay.classList.contains('show')) {
                    hideModal();
                }
            });

            // Submit button functionality
            modalSubmit.addEventListener('click', function() {
                const selectedContestKey = contestSelect.value;
                if (!selectedContestKey) {
                    alert('Please select a contest first.');
                    return;
                }
                
                let displayName = '';
                let isGroupSelection = false;
                
                // Handle group selections vs individual year selections
                if (selectedContestKey.startsWith('group_')) {
                    isGroupSelection = true;
                    // Extract contest name and region from group key
                    const groupParts = selectedContestKey.replace('group_', '').split('_');
                    const contestName = groupParts[0];
                    const region = groupParts.slice(1).join('_'); // Handle regions with underscores
                    
                    // For group selections, use the contest name and region directly
                    displayName = `${contestName} - ${region}`;
                } else {
                    // Get the contest data for individual year selections
                    const contest = processedData[selectedContestKey];
                    displayName = contest ? `${contest.fullName} ${contest.year} - ${contest.region}` : selectedContestKey;
                }
                
                // Check if this is the statements modal and handle mailto
                const modalTitle = document.getElementById('modal-title').textContent;
                if (modalTitle === 'Submit Problem Statements') {
                    uploadPDF(document.getElementById('contest-select').value);
                } else if (modalTitle === 'Submit Test Data') {
                    // Create mailto link for test data
                    const githubUsername = document.getElementById('github-username').value.trim();
                    const subject = `Test Data for ${displayName}`;
                    const body = `GitHub username: ${githubUsername}`;
                    
                    const mailtoLink = `mailto:fredrik@icpc.global?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                    window.open(mailtoLink);
                } else if (modalTitle === 'Submit Solutions') {
                    // Create mailto link for solutions
                    const githubUsername = document.getElementById('github-username').value.trim();
                    const subject = `Problem Solutions for ${displayName}`;
                    const body = `GitHub username: ${githubUsername}`;
                    
                    const mailtoLink = `mailto:fredrik@icpc.global?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                    window.open(mailtoLink);
                } else if (modalTitle === 'Submit Packages') {
                    // Create mailto link for packages
                    const githubUsername = document.getElementById('github-username').value.trim();
                    const subject = `Problem Packages for ${displayName}`;
                    const body = `GitHub username: ${githubUsername}`;
                    
                    const mailtoLink = `mailto:fredrik@icpc.global?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                    window.open(mailtoLink);
                } else {
                    // For other modals, show the original success message
                    alert(`Thank you! Your submission for ${displayName} has been received. We'll contact you via email with next steps.`);
                }
                
                hideModal();
            });

            // Add click event listeners to help buttons
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('help-button')) {
                    const buttonText = e.target.textContent.toLowerCase();
                    
                    if (buttonText.includes('problem statements')) {
                        showModal('statements');
                    } else if (buttonText.includes('test data')) {
                        showModal('data');
                    } else if (buttonText.includes('solutions')) {
                        showModal('solutions');
                    } else if (buttonText.includes('packages') && !buttonText.includes('create')) {
                        showModal('packages');
                    } else if (buttonText.includes('create packages')) {
                        showModal('create-packages');
                    }
                }
            });

            // Add click event listeners to progress badges
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('clickable-badge')) {
                    const badgeType = e.target.getAttribute('data-badge-type');
                    const badgeContext = e.target.getAttribute('data-badge-context');
                    const contestData = e.target.getAttribute('data-contest-data');
                    
                    if (contestData) {
                        const contest = JSON.parse(contestData);
                        let modalType = '';
                        
                        // Map badge types to modal types
                        if (badgeType === 'stmt') {
                            modalType = 'statements';
                        } else if (badgeType === 'data') {
                            modalType = 'data';
                        } else if (badgeType === 'sol') {
                            modalType = 'solutions';
                        } else if (badgeType === 'pkg') {
                            // For packages, check if all other components are complete
                            if (badgeContext === 'year') {
                                // For individual year, check if stmt, data, and sol are all 100%
                                const progress = calculateProgress([contest]);
                                if (progress.stmt === 100 && progress.data === 100 && progress.sol === 100) {
                                    modalType = 'create-packages';
                                } else {
                                    modalType = 'packages';
                                }
                            } else if (badgeContext === 'contest') {
                                // For contest level, check if all years have complete stmt, data, and sol
                                const allYearsComplete = contest.contests.every(c => {
                                    const yearProgress = calculateProgress([c]);
                                    return yearProgress.stmt === 100 && yearProgress.data === 100 && yearProgress.sol === 100;
                                });
                                if (allYearsComplete) {
                                    modalType = 'create-packages';
                                } else {
                                    modalType = 'packages';
                                }
                            } else {
                                // For region level, default to packages
                                modalType = 'packages';
                            }
                        }
                        
                        if (modalType) {
                            // For contest-level badges, we need to create a special contest object
                            // that represents the general contest (not a specific year)
                            if (badgeContext === 'contest') {
                                // Create a general contest object for the modal
                                const generalContest = {
                                    fullName: contest.fullName,
                                    region: contest.contests[0]?.region || 'Unknown',
                                    year: null, // No specific year
                                    isGeneralContest: true,
                                    contestCategory: contest
                                };
                                showModalWithContest(modalType, generalContest);
                            } else {
                                showModalWithContest(modalType, contest);
                            }
                        }
                    }
                }
            });
        });

        const UPLOAD_URL = 'https://script.google.com/macros/s/AKfycbxujEuQzZ5C3SvPQbpHsct6cPWNB2d65A2AlwJFmhVZgsPz_T6WKVYxOJUTzFq5dLvs/exec';

        async function uploadPDF(folderName) {
            const file = document.getElementById('statement-pdf').files[0];
            if (!file) return;

            // Disable input while uploading
            document.getElementById('statement-pdf').disabled = true;

            const reader = new FileReader();
            reader.onload = async () => {
                try {
                    const base64 = reader.result.split(',')[1];
                    const formData = new FormData();
                    formData.append('file', base64);
                    formData.append('filename', file.name);
                    formData.append('type', file.type);
                
                    const subfolderName = folderName;

                    console.log("foldername", subfolderName);
                    formData.append('subfolder', subfolderName);

                    console.log('Uploading to subfolder:', subfolderName);
                    
                    const response = await fetch(UPLOAD_URL, { 
                        method: 'POST', 
                        body: formData 
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        console.log('Upload successful!');
                        console.log('File:', result.message);
                        console.log('Folder:', result.folder);
                        console.log('URL:', result.url);
                        alert(result.message);
                    } else {
                        console.error('Upload failed:', result.message);
                        alert(result.message);
                    }
                    
                    // Reset file input
                    document.getElementById('statement-pdf').value = '';
                    
                } catch (error) {
                    console.error('Upload error:', error);
                    alert('Upload failed: ' + error.message);
                } finally {
                    // Re-enable input
                    document.getElementById('statement-pdf').disabled = false;
                }
            };
            
            reader.readAsDataURL(file);
        };

    </script>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p class="footer-title">2025 ICPC Problem Archive Project - Preserving Programming Contest History</p>
            <p class="footer-disclaimer">This project is not officially affiliated with ICPC Global but aims to support the community</p>
        </div>
    </footer>
</body>
</html> 